{% extends "flexigrid.j2" %}

{% block sidebar %}
<h3>Locations</h3>
<div id="map"></div>
<p>View <a href="map.html">this map</a> on a page</p>
{% endblock %}

{% block extrahead %}
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
<style>
#map {height: 200px}
</style>
{% endblock %}

{% block footscripts %}
<script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>

<!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if necessary -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
<script>window.jQuery || document.write('<script src="js/libs/jquery-1.5.1.min.js">\x3C/script>')</script>

<script>

function createMap(){
 var map = L.map('map').setView([20, 0], 2);
 var baseMap = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
    maxZoom: 18
 });
 var sMap = L.tileLayer('http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg', {
 attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, ' +
 '<a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; ' +
 'Map data {attribution.OpenStreetMap}',
 maxZoom: 16, minZoom: 2
 });
 sMap.addTo(map);
 $.getJSON("{{media_url('/json/map.json')}}", function(data) {
    var geojson = L.geoJson(data, {
      onEachFeature: function (feature, layer) {
        layer.bindPopup("<a class=\"mapfeature\" href='"+feature.properties.link+"'>"+feature.properties.name+"</a>");
      }
    });
    geojson.addTo(map);
  });
};

$(document).ready(createMap);


</script>
{% endblock %}

